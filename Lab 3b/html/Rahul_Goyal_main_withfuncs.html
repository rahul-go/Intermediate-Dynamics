
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Rahul_Goyal_main Usage and Description</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-02-06"><meta name="DC.source" content="Rahul_Goyal_main.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Rahul_Goyal_main Usage and Description</h1><!--introduction--><p>ME 326 Winter 2018 - Laboratory Assignment #3B</p><p><b>Author:</b> RAHUL GOYAL</p><p>California Polytechnic State University, San Luis Obispo, CA</p><p><b>Date Created:</b> January 30, 2018</p><p><b>Date Modified:</b> February 06, 2018</p><p><b>Description:</b> This script simulates the suspension of a quarter-car, modeled with state-space representation. Two models are evaluated at two separate horizontal velocities. The first model assumes that the tires never leave the ground, that is, they stick to the ground. The second model does not make this invalid assumption. This script then compares the two models: it compares the vertical displacements of the car's sprung mass across the two models, and it compares the vertical displacements of the car's unsprung mass across the two models. Additionally the script compares the relationship between the vertical displacements of the car's sprung mass and the car's unsprung mass side-by-side as an effect of each model. This is repeated for both horizontal velocities (and corresponding simulation distances) supplied.</p><p><b>Required Files:</b></p><div><ul><li>CarEOM.m - This file contains a function that represents the equations of motion for the "unstuck" simulation. It returns xdot with inputs of time, x, the A and B state-space matrices, the slope data, the horizontal velocity of the car, the tire's spring constant, the car's unsprung mass, the car's sprung weight, and the car's unsprung weight.</li></ul><h2>Called Functions</h2><ul><li><a href="#CarEOM">CarEOM </a></li></ul></div><p><b>Still To Do:</b></p><div><ul><li>Done!</li></ul></div><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Problem Statement</a></li><li><a href="#2">Reset</a></li><li><a href="#3">Set Values</a></li><li><a href="#4">Given Values</a></li><li><a href="#5">Solved Values</a></li><li><a href="#6">Start a "for" Loop</a></li><li><a href="#8">Generate a Curb Profile</a></li><li><a href="#13">Simulating the Stuck Quarter-Car Using lsim</a></li><li><a href="#14">Simulating the Unstuck Quarter-Car Using ode45</a></li><li><a href="#15">End the "for" Loop</a></li><li><a href="#17">Displacement of Sprung Mass vs. Time (5 mph)</a></li><li><a href="#18">Displacement of Unsprung Mass vs. Time (5 mph)</a></li><li><a href="#19">Displacement of Sprung and Unsprung Mass vs. Time (5 mph)</a></li><li><a href="#20">Displacement of Sprung Mass vs. Time (60 mph)</a></li><li><a href="#21">Displacement of Unsprung Mass vs. Time (60 mph)</a></li><li><a href="#22">Displacement of Sprung and Unsprung Mass vs. Time (60 mph)</a></li><li><a href="#23">Discussion</a></li></ul></div><h2 id="1">Problem Statement</h2><p>Continue the analysis of the quarter-car model. The associated parameters will be the same as in the previous portion of the assignment. That is: wc = 750 lb, wu = 85 lb, ks = 200 lb/in, bs = 60 lb &middot; s/in, and kt = 1600 lb/in. However, the inputs to the system will change; compute the response of your quarter-car to an approximation of a 4-inch tall by 6-inch wide curb.</p><h2 id="2">Reset</h2><p>The following was used while debugging.</p><pre class="codeinput">close <span class="string">all</span>;
clear <span class="string">all</span>;
clc;
</pre><h2 id="3">Set Values</h2><p>The following is used to easily change the set horizontal velocity of the car and the corresponding simulation distances.</p><pre class="codeinput">v_x = 22/15 * [5, 60];          <span class="comment">% Horizontal velocity of car (ft/s)</span>
d_f = [10, 30];                 <span class="comment">% Corresponding simulation distances (ft)</span>
</pre><h2 id="4">Given Values</h2><p>The following assigns values given by the problem statement to variables. (The value of the gravitational constant is assumed).</p><pre class="codeinput"><span class="comment">% Given Values</span>
w_c = 750;                      <span class="comment">% Weight of car's sprung mass (lb)</span>
w_u = 85;                       <span class="comment">% Weight of car's unsprung mass (lb)</span>
k_s = 200;                      <span class="comment">% Spring constant of the suspension (lb/in)</span>
b_s = 60;                       <span class="comment">% Damping coeff of the suspension (lb*s/in)</span>
k_t = 1600;                     <span class="comment">% Spring constant of tire (lb/in)</span>
g = 32.174*12;                  <span class="comment">% Gravitational constant (in/s^2)</span>
h = 4;                          <span class="comment">% Height of curb (in)</span>
w = 6/12;                       <span class="comment">% Width of curb (ft)</span>

<span class="comment">% Initial conditions (y_r, y_u, y_c, yu_dot, yc_dot)</span>
ICs = [0;                       <span class="comment">% Road displacement (in)</span>
       0;                       <span class="comment">% Car's unsprung mass dispacement (in)</span>
       0;                       <span class="comment">% Car's sprung mass displacement (in)</span>
       0;                       <span class="comment">% Car's unsprung mass velocity (in/s)</span>
       0];                      <span class="comment">% Car's sprung mass velocity (in/s)</span>
</pre><h2 id="5">Solved Values</h2><p>The following assigns values derived and/or solved from the given values to variables. See the attached sheet for hand calculations.</p><pre class="codeinput"><span class="comment">% Solved Values</span>
m_c = w_c/g;                    <span class="comment">% Mass of car's sprung mass (slinches)</span>
m_u = w_u/g;                    <span class="comment">% Mass of car's unsprung mass (slinches)</span>

<span class="comment">% State-Space Matrices</span>
A = [0, 0, 0, 0, 0;
     0, 0, 0, 1, 0;
     0, 0, 0, 0, 1;
     k_t/m_u, -(k_s+k_t)/m_u, k_s/m_u, -b_s/m_u, b_s/m_u;
     0, k_s/m_c, -k_s/m_c, b_s/m_c, -b_s/m_c];

B = [1;
     0;
     0;
     0;
     0];

C = [1, 0, 0, 0, 0;
     0, 1, 0, 0, 0;
     0, 0, 1, 0, 0;
     0, 0, 0, 0, 0;
     0, 0, 0, 1, 0;
     0, 0, 0, 0, 1;
     0, -k_s, k_s, -b_s, b_s];

D = [0;
     0;
     0;
     1;
     0;
     0;
     0];
</pre><h2 id="6">Start a "for" Loop</h2><p>The following starts a "for" loop to run the simulation at various horizontal velocities with their corresponding simulation distances (supplied above in the "Set Values" section).</p><pre class="codeinput"><span class="keyword">for</span> i = 1:length(v_x)
</pre><h2 id="8">Generate a Curb Profile</h2><p>The following generates a curb profile by setting a resolution, setting the curb's start position, and setting the slope impulse's width. From these, it calculates the curb's end position and the slope impulse's height. Knowing these provides all the information required for generating a curb profile.</p><p>A smaller resolution sacrifices realism for performance. My simulation provides visually indistinguishable results for resolutions greater than or equal to 1.</p><pre class="codeinput">res = 1;                        <span class="comment">% Resolution scalar (unitless)</span>
</pre><p>The curb's start position is set arbitrarily (yet reasonably); the curb's end position is calculated as the curb's start position plus the width of the curb. The slope impulse's width is theoretically inifinitesimal; it is set to a value that balances realism with performance. Because integrating the slope impulse must equal the height of the curb, the slope impulse's width times the slope impulse's height must also equal the height of the curb. Thus, the slope's height is calculated as the height of the curb divided by slope impulse's width.</p><pre class="codeinput"><span class="comment">% Curb Positions</span>
d1 = 1;                         <span class="comment">% Curb start position (ft)</span>
d2 = d1+w;                      <span class="comment">% Curb end position (ft)</span>

<span class="comment">% Slope Impulses</span>
dw = 0.001;                     <span class="comment">% Slope impulse "width" (ft)</span>
k_w = h/dw;                     <span class="comment">% Slope impulse "height" (in/ft)</span>
</pre><p>The following creates an empty curb profile, then adds a (positive) "impulse" at from d1 to d1+dx and a (negative) "impulse" from d2 to d2+dx to simulate a Dirac delta function at the start and end conditions of the curb. The code does this by adding the calculated impulse for all values corresponding to greater than d1, then subtracting the calculated impulse for all values corresponding to greater than d1+dx. Thus, only the values between d1 and d1+dx have the calculated impulse added to them. A similar procedure, but negated, is followed to add the negative impulse to the values between d2 and d2+dx.</p><pre class="codeinput">d = (0:dw/res:d_f(i))';         <span class="comment">% Positions list (ft)</span>
slope = [d, zeros(size(d))];	<span class="comment">% Empty curb profile (ft, in/ft)</span>

<span class="comment">% Add k_w to all corresponding slopes greater than d1</span>
slope(d&gt;=d1, 2) = slope(d&gt;=d1, 2) + k_w;
<span class="comment">% Subtract k_w from all corresponding slopes greater than d1 + dw</span>
slope(d&gt;=d1+dw, 2) = slope(d&gt;=d1+dw, 2) - k_w;
<span class="comment">% Add negative k_w to all corresponding slopes greater than d2</span>
slope(d&gt;=d2, 2) = slope(d&gt;=d2, 2) - k_w;
<span class="comment">% Subtract negative k_w from all corresponding slopes greater than d2 + dw</span>
slope(d&gt;=d2+dw, 2) = slope(d&gt;=d2+dw, 2) + k_w;

<span class="comment">% Debugging statement</span>
<span class="comment">% plot(slope);</span>
</pre><p>The following calculates the time step and the final time to create a list of times.</p><pre class="codeinput">t_step = (dw/v_x(i));           <span class="comment">% Time step (s)</span>
t_f = d_f(i)/v_x(i);            <span class="comment">% Time final (s)</span>
t{i} = (0:t_step:t_f)';         <span class="comment">% Times list (s)</span>
</pre><h2 id="13">Simulating the Stuck Quarter-Car Using lsim</h2><p>The following simulates the stuck quarter-car using lsim. It creates a state-space system object, calculates the u values corresponding to the time values, then solves for y using lsim.</p><pre class="codeinput"><span class="comment">% State-Space System Object</span>
sys = ss(A, B, C, D);

xr_stuck = v_x(i)*t{i};         <span class="comment">% Corresponding distance values (ft)</span>
<span class="comment">% Interpolate corresponding slope values from road_slope_data</span>
mr_stuck = interp1(slope(:, 1), slope(:, 2), xr_stuck); <span class="comment">% (in/ft)</span>
u_stuck = v_x(i)*mr_stuck;      <span class="comment">% Corresponding u (yr_dot) values (in/s)</span>

<span class="comment">% Solve for y</span>
y_stuck{i} = lsim(sys, u_stuck, t{i});

<span class="comment">% Debugging statement</span>
<span class="comment">% plot(t, y_stuck);               % Plots y (7 variables) vs. t (stuck)</span>
</pre><h2 id="14">Simulating the Unstuck Quarter-Car Using ode45</h2><p>The following solves the differential equation xdot = A*x + B*u using ode45. The function CarEOM, which represents this differential equation, contains logic that allows the quarter-car's tire to leave the ground. Because ode45 does not return the u values (in this case, the vertical component component of the velocity of the car) corresponding to the time and x values it returns, the main script finds them by solving for the corresponding distance values, from which it interpolates the corresponding slope values, from which it solves for the corresponding u values, the vertical component of the velocity of the car. Then, knowing the x and u values, the script solves y = C*x + D*u using matrix multiplication.</p><pre class="codeinput"><span class="comment">% The following line prevents ode45 from stepping over the narrow slope</span>
<span class="comment">% impulse.</span>
options = odeset(<span class="string">'MaxStep'</span>, t_step);

<span class="comment">% Quarter-Car Differential Equation Setup</span>
CarODE = @(t, x) CarEOM(t, x, A, B, slope, v_x(i), k_t, m_u, w_c, w_u);
<span class="comment">% Solve for x</span>
[~, x_unstuck] = ode45(CarODE, t{i}, ICs, options);

xr_unstuck = v_x(i)*t{i};       <span class="comment">% Corresponding distance values (ft)</span>
<span class="comment">% Interpolate corresponding slope values from road_slope_data</span>
mr_unstuck = interp1(slope(:, 1), slope(:, 2), xr_unstuck); <span class="comment">% (in/ft)</span>
u_unstuck = v_x(i)*mr_unstuck;  <span class="comment">% Corresponding u (yr_dot) values (in/s)</span>

<span class="comment">% Solve for y</span>
y_unstuck{i} = C*x_unstuck' + D*u_unstuck';

<span class="comment">% Debugging statement</span>
<span class="comment">% plot(t, y_unstuck);             % Plots y (7 variables) vs. t (unstuck)</span>
</pre><h2 id="15">End the "for" Loop</h2><p>The following ends the "for" loop.</p><pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="17">Displacement of Sprung Mass vs. Time (5 mph)</h2><p>The following plots the vertical displacement of the sprung mass as a function of time when the horizontal velocity of the car is 5 mph, comparing the models plotted on each other.</p><p>The plot indicates a significant difference between the stuck and unstuck models at 5 mph. Whereas the stuck model exhibits a sudden shift from upward displacement to downward displacement as soon as the curb ends, the unstuck model shows a continuous upward displacement until experiencing a gradual change in direction to downward displacement, probably as a result from the energy of the compressed suspension. Both displacements eventually dampen to a steady-state of 0, as expected with no further road input.</p><pre class="codeinput">figure;

plot(t{1}, y_stuck{1}(:, 3), t{1}, y_unstuck{1}(3, :), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Sprung Mass vs. Time (5 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 1: \rmDisplacement of Sprung Mass vs. Time (5 mph)'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Stuck'</span>,<span class="string">'Unstuck'</span>);
</pre><img vspace="5" hspace="5" src="Rahul_Goyal_main_01.png" style="width:560px;height:420px;" alt=""> <h2 id="18">Displacement of Unsprung Mass vs. Time (5 mph)</h2><p>The following plots the vertical displacement of the unsprung mass as a function of time when the horizontal velocity of the car is 5 mph, comparing the models plotted on each other.</p><p>The analysis of this plot falls in line with the analysis of the previous plot.</p><pre class="codeinput">figure;

plot(t{1}, y_stuck{1}(:, 2), t{1}, y_unstuck{1}(2, :), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Unsprung Mass vs. Time (5 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 2: \rmDisplacement of Unsprung Mass vs. Time (5 mph)'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Stuck'</span>,<span class="string">'Unstuck'</span>);
</pre><img vspace="5" hspace="5" src="Rahul_Goyal_main_02.png" style="width:560px;height:420px;" alt=""> <h2 id="19">Displacement of Sprung and Unsprung Mass vs. Time (5 mph)</h2><p>The following plots the vertical displacement of the sprung and unsprung mass as a function of time when the horizontal velocity of the car is 5 mph, comparing the stuck and unstuck models side-by-side.</p><p>As expected, the plot indicates that the unsprung mass reacts more suddenly than the sprung mass; yet, the sprung mass follows closely, probably because the horizontal velocity of the car is relatively slow at 5 mph.</p><pre class="codeinput">figure;

<span class="comment">% Subplot (stuck)</span>
subplot(2, 1, 1);
plot(t{1}, y_stuck{1}(:, 3), t{1}, y_stuck{1}(:, 2), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Unsprung Mass vs. Time (5 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 3a: \rmStuck Tires'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Sprung Mass'</span>,<span class="string">'Unsprung Mass'</span>);

<span class="comment">% Subplot (unstuck)</span>
subplot(2, 1, 2);
plot(t{1}, y_unstuck{1}(3, :), t{1}, y_unstuck{1}(2, :), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Unsprung Mass vs. Time (5 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 3b: \rmUnstuck Tires'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Sprung Mass'</span>,<span class="string">'Unsprung Mass'</span>);
</pre><img vspace="5" hspace="5" src="Rahul_Goyal_main_03.png" style="width:560px;height:420px;" alt=""> <h2 id="20">Displacement of Sprung Mass vs. Time (60 mph)</h2><p>The following plots the vertical displacement of the sprung mass as a function of time when the horizontal velocity of the car is 60 mph, comparing the models plotted on each other.</p><p>The plot indicates an insignificant difference between the stuck and unstuck models at 60 mph, probably because the tires do not leave the ground for long at such relatively high speeds.</p><pre class="codeinput">figure;

plot(t{2}, y_stuck{2}(:, 3), t{2}, y_unstuck{2}(3, :), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Sprung Mass vs. Time (60 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 4: \rmDisplacement of Sprung Mass vs. Time (60 mph)'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Stuck'</span>,<span class="string">'Unstuck'</span>);
</pre><img vspace="5" hspace="5" src="Rahul_Goyal_main_04.png" style="width:560px;height:420px;" alt=""> <h2 id="21">Displacement of Unsprung Mass vs. Time (60 mph)</h2><p>The following plots the vertical displacement of the unsprung mass as a function of time when the horizontal velocity of the car is 60 mph, comparing the models plotted on each other.</p><p>The analysis of this plot falls in line with the analysis of the previous plot.</p><pre class="codeinput">figure;

plot(t{2}, y_stuck{2}(:, 2), t{2}, y_unstuck{2}(2, :), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Unsprung Mass vs. Time (60 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 5: \rmDisplacement of Unsprung Mass vs. Time (60 mph)'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Stuck'</span>,<span class="string">'Unstuck'</span>);
</pre><img vspace="5" hspace="5" src="Rahul_Goyal_main_05.png" style="width:560px;height:420px;" alt=""> <h2 id="22">Displacement of Sprung and Unsprung Mass vs. Time (60 mph)</h2><p>The following plots the vertical displacement of the sprung and unsprung mass as a function of time when the horizontal velocity of the car is 5 mph, comparing the stuck and unstuck models side-by-side.</p><p>% As expected, the plot indicates that the unsprung mass reacts more suddenly than the sprung mass; the sprung mass displaces relatively little, probably because the horizontal velocity of the car is relatively fast at 60 mph.</p><pre class="codeinput">figure;

<span class="comment">% Subplot (stuck)</span>
subplot(2, 1, 1);
plot(t{2}, y_stuck{2}(:, 3), t{2}, y_stuck{2}(:, 2), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Unsprung Mass vs. Time (60 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 6a: \rmStuck Tires'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Sprung Mass'</span>,<span class="string">'Unsprung Mass'</span>);

<span class="comment">% Subplot (unstuck)</span>
subplot(2, 1, 2);
plot(t{2}, y_unstuck{2}(3, :), t{2}, y_unstuck{2}(2, :), <span class="string">'LineWidth'</span>, 2);
title(<span class="string">'Displacement of Unsprung Mass vs. Time (60 mph)'</span>);
xlabel({<span class="string">'Time (s)'</span>
        <span class="string">''</span>
        <span class="comment">% Figure label</span>
        <span class="string">'\bfFigure 6b: \rmUnstuck Tires'</span>});
ylabel(<span class="string">'Displacement (in)'</span>);
legend(<span class="string">'Sprung Mass'</span>,<span class="string">'Unsprung Mass'</span>);
</pre><img vspace="5" hspace="5" src="Rahul_Goyal_main_06.png" style="width:560px;height:420px;" alt=""> <h2 id="23">Discussion</h2><p>While lsim generally produces quicker results, ode45 allows for more user control. Each method is better suited for different purposes. Using lsim was easier to simulate the quarter-car assuming that the tire never leave the ground, for example, as in lab 3a. Using ode45 was easier to simulate the quarter-car if it cannot be assumed that the tires never leave the ground. Using ode45, it is easy to add logic that allows the quarter-car's tire to leave the ground because the programmer has easy access to the non-mathematical relationship between xdot and x. However, running ode45 with narrow impulses meant to simulate Dirac delta functions is tricky because ode45 often "steps" over the narrow input. Thus, the maximum step used by ode45 must be manually set for that one specific condition, slowing the entire run process. Thus, the choice between using lsim and ode45 should depend on the application.</p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Rahul_Goyal_main Usage and Description
% ME 326 Winter 2018 - Laboratory Assignment #3B
%
% *Author:* RAHUL GOYAL
%
% California Polytechnic State University, San Luis Obispo, CA
%
% *Date Created:* January 30, 2018
%
% *Date Modified:* February 06, 2018
%
% *Description:*
% This script simulates the suspension of a quarter-car, modeled with
% state-space representation. Two models are evaluated at two separate
% horizontal velocities. The first model assumes that the tires never leave
% the ground, that is, they stick to the ground. The second model does not
% make this invalid assumption. This script then compares the two models:
% it compares the vertical displacements of the car's sprung mass across
% the two models, and it compares the vertical displacements of the car's
% unsprung mass across the two models. Additionally the script compares the
% relationship between the vertical displacements of the car's sprung mass
% and the car's unsprung mass side-by-side as an effect of each model. This
% is repeated for both horizontal velocities (and corresponding simulation
% distances) supplied.
% 
% *Required Files:*
%
% * CarEOM.m - This file contains a function that represents the equations
% of motion for the "unstuck" simulation. It returns xdot with inputs of
% time, x, the A and B state-space matrices, the slope data, the horizontal
% velocity of the car, the tire's spring constant, the car's unsprung mass,
% the car's sprung weight, and the car's unsprung weight.
%
% *Still To Do:*
%
% * Done!



%% Problem Statement
% Continue the analysis of the quarter-car model. The associated parameters
% will be the same as in the previous portion of the assignment. That is:
% wc = 750 lb, wu = 85 lb, ks = 200 lb/in, bs = 60 lb Â· s/in, and kt = 1600
% lb/in. However, the inputs to the system will change; compute the
% response of your quarter-car to an approximation of a 4-inch tall by
% 6-inch wide curb.



%% Reset
% The following was used while debugging.

close all;
clear all;
clc;



%% Set Values
% The following is used to easily change the set horizontal velocity of the
% car and the corresponding simulation distances.
v_x = 22/15 * [5, 60];          % Horizontal velocity of car (ft/s)
d_f = [10, 30];                 % Corresponding simulation distances (ft)



%% Given Values
% The following assigns values given by the problem statement to variables.
% (The value of the gravitational constant is assumed).

% Given Values
w_c = 750;                      % Weight of car's sprung mass (lb)
w_u = 85;                       % Weight of car's unsprung mass (lb)
k_s = 200;                      % Spring constant of the suspension (lb/in)
b_s = 60;                       % Damping coeff of the suspension (lb*s/in)
k_t = 1600;                     % Spring constant of tire (lb/in)
g = 32.174*12;                  % Gravitational constant (in/s^2)
h = 4;                          % Height of curb (in)
w = 6/12;                       % Width of curb (ft)

% Initial conditions (y_r, y_u, y_c, yu_dot, yc_dot)
ICs = [0;                       % Road displacement (in)
       0;                       % Car's unsprung mass dispacement (in)
       0;                       % Car's sprung mass displacement (in)
       0;                       % Car's unsprung mass velocity (in/s)
       0];                      % Car's sprung mass velocity (in/s)



%% Solved Values
% The following assigns values derived and/or solved from the given values
% to variables. See the attached sheet for hand calculations.

% Solved Values
m_c = w_c/g;                    % Mass of car's sprung mass (slinches)
m_u = w_u/g;                    % Mass of car's unsprung mass (slinches)

% State-Space Matrices
A = [0, 0, 0, 0, 0;
     0, 0, 0, 1, 0;
     0, 0, 0, 0, 1;
     k_t/m_u, -(k_s+k_t)/m_u, k_s/m_u, -b_s/m_u, b_s/m_u;
     0, k_s/m_c, -k_s/m_c, b_s/m_c, -b_s/m_c];

B = [1;
     0;
     0;
     0;
     0];

C = [1, 0, 0, 0, 0;
     0, 1, 0, 0, 0;
     0, 0, 1, 0, 0;
     0, 0, 0, 0, 0;
     0, 0, 0, 1, 0;
     0, 0, 0, 0, 1;
     0, -k_s, k_s, -b_s, b_s];

D = [0;
     0;
     0;
     1;
     0;
     0;
     0];



%% Start a "for" Loop
% The following starts a "for" loop to run the simulation at various
% horizontal velocities with their corresponding simulation distances
% (supplied above in the "Set Values" section).
for i = 1:length(v_x)

    
    
%% Generate a Curb Profile
% The following generates a curb profile by setting a resolution, setting
% the curb's start position, and setting the slope impulse's width. From
% these, it calculates the curb's end position and the slope impulse's
% height. Knowing these provides all the information required for
% generating a curb profile.


%%
% A smaller resolution sacrifices realism for performance. My simulation
% provides visually indistinguishable results for resolutions greater than
% or equal to 1.
res = 1;                        % Resolution scalar (unitless)



%%
% The curb's start position is set arbitrarily (yet reasonably); the curb's
% end position is calculated as the curb's start position plus the width of
% the curb. The slope impulse's width is theoretically inifinitesimal; it
% is set to a value that balances realism with performance. Because
% integrating the slope impulse must equal the height of the curb, the
% slope impulse's width times the slope impulse's height must also equal
% the height of the curb. Thus, the slope's height is calculated as the
% height of the curb divided by slope impulse's width.

% Curb Positions
d1 = 1;                         % Curb start position (ft)
d2 = d1+w;                      % Curb end position (ft)

% Slope Impulses
dw = 0.001;                     % Slope impulse "width" (ft)
k_w = h/dw;                     % Slope impulse "height" (in/ft)

%%
% The following creates an empty curb profile, then adds a (positive)
% "impulse" at from d1 to d1+dx and a (negative) "impulse" from d2 to d2+dx
% to simulate a Dirac delta function at the start and end conditions of the
% curb. The code does this by adding the calculated impulse for all values
% corresponding to greater than d1, then subtracting the calculated impulse
% for all values corresponding to greater than d1+dx. Thus, only the values
% between d1 and d1+dx have the calculated impulse added to them. A similar
% procedure, but negated, is followed to add the negative impulse to the
% values between d2 and d2+dx.

d = (0:dw/res:d_f(i))';         % Positions list (ft)
slope = [d, zeros(size(d))];	% Empty curb profile (ft, in/ft)

% Add k_w to all corresponding slopes greater than d1
slope(d>=d1, 2) = slope(d>=d1, 2) + k_w;
% Subtract k_w from all corresponding slopes greater than d1 + dw
slope(d>=d1+dw, 2) = slope(d>=d1+dw, 2) - k_w;
% Add negative k_w to all corresponding slopes greater than d2
slope(d>=d2, 2) = slope(d>=d2, 2) - k_w;
% Subtract negative k_w from all corresponding slopes greater than d2 + dw
slope(d>=d2+dw, 2) = slope(d>=d2+dw, 2) + k_w;

% Debugging statement
% plot(slope);

%%
% The following calculates the time step and the final time to create a
% list of times.

t_step = (dw/v_x(i));           % Time step (s)
t_f = d_f(i)/v_x(i);            % Time final (s)
t{i} = (0:t_step:t_f)';         % Times list (s)



%% Simulating the Stuck Quarter-Car Using lsim
% The following simulates the stuck quarter-car using lsim. It creates a
% state-space system object, calculates the u values corresponding to the
% time values, then solves for y using lsim.

% State-Space System Object
sys = ss(A, B, C, D);  

xr_stuck = v_x(i)*t{i};         % Corresponding distance values (ft)
% Interpolate corresponding slope values from road_slope_data
mr_stuck = interp1(slope(:, 1), slope(:, 2), xr_stuck); % (in/ft)
u_stuck = v_x(i)*mr_stuck;      % Corresponding u (yr_dot) values (in/s)

% Solve for y
y_stuck{i} = lsim(sys, u_stuck, t{i});

% Debugging statement
% plot(t, y_stuck);               % Plots y (7 variables) vs. t (stuck)



%% Simulating the Unstuck Quarter-Car Using ode45
% The following solves the differential equation xdot = A*x + B*u using
% ode45. The function CarEOM, which represents this differential equation,
% contains logic that allows the quarter-car's tire to leave the ground.
% Because ode45 does not return the u values (in this case, the vertical
% component component of the velocity of the car) corresponding to the time
% and x values it returns, the main script finds them by solving for the
% corresponding distance values, from which it interpolates the
% corresponding slope values, from which it solves for the corresponding u
% values, the vertical component of the velocity of the car. Then, knowing
% the x and u values, the script solves y = C*x + D*u using matrix
% multiplication.

% The following line prevents ode45 from stepping over the narrow slope
% impulse.
options = odeset('MaxStep', t_step);

% Quarter-Car Differential Equation Setup
CarODE = @(t, x) CarEOM(t, x, A, B, slope, v_x(i), k_t, m_u, w_c, w_u);
% Solve for x
[~, x_unstuck] = ode45(CarODE, t{i}, ICs, options);

xr_unstuck = v_x(i)*t{i};       % Corresponding distance values (ft)
% Interpolate corresponding slope values from road_slope_data
mr_unstuck = interp1(slope(:, 1), slope(:, 2), xr_unstuck); % (in/ft)
u_unstuck = v_x(i)*mr_unstuck;  % Corresponding u (yr_dot) values (in/s)

% Solve for y
y_unstuck{i} = C*x_unstuck' + D*u_unstuck';

% Debugging statement
% plot(t, y_unstuck);             % Plots y (7 variables) vs. t (unstuck)



%% End the "for" Loop
% The following ends the "for" loop.
end



%% Displacement of Sprung Mass vs. Time (5 mph)
% The following plots the vertical displacement of the sprung mass as a
% function of time when the horizontal velocity of the car is 5 mph,
% comparing the models plotted on each other.
% 
% The plot indicates a significant difference between the stuck and unstuck
% models at 5 mph. Whereas the stuck model exhibits a sudden shift from
% upward displacement to downward displacement as soon as the curb ends,
% the unstuck model shows a continuous upward displacement until
% experiencing a gradual change in direction to downward displacement,
% probably as a result from the energy of the compressed suspension. Both
% displacements eventually dampen to a steady-state of 0, as expected with
% no further road input.

figure;

plot(t{1}, y_stuck{1}(:, 3), t{1}, y_unstuck{1}(3, :), 'LineWidth', 2);
title('Displacement of Sprung Mass vs. Time (5 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 1: \rmDisplacement of Sprung Mass vs. Time (5 mph)'});
ylabel('Displacement (in)');
legend('Stuck','Unstuck');



%% Displacement of Unsprung Mass vs. Time (5 mph)
% The following plots the vertical displacement of the unsprung mass as a
% function of time when the horizontal velocity of the car is 5 mph,
% comparing the models plotted on each other.
% 
% The analysis of this plot falls in line with the analysis of the previous
% plot.

figure;

plot(t{1}, y_stuck{1}(:, 2), t{1}, y_unstuck{1}(2, :), 'LineWidth', 2);
title('Displacement of Unsprung Mass vs. Time (5 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 2: \rmDisplacement of Unsprung Mass vs. Time (5 mph)'});
ylabel('Displacement (in)');
legend('Stuck','Unstuck');



%% Displacement of Sprung and Unsprung Mass vs. Time (5 mph)
% The following plots the vertical displacement of the sprung and unsprung
% mass as a function of time when the horizontal velocity of the car is 5
% mph, comparing the stuck and unstuck models side-by-side.
% 
% As expected, the plot indicates that the unsprung mass reacts more
% suddenly than the sprung mass; yet, the sprung mass follows closely,
% probably because the horizontal velocity of the car is relatively slow at
% 5 mph.

figure;

% Subplot (stuck)
subplot(2, 1, 1);
plot(t{1}, y_stuck{1}(:, 3), t{1}, y_stuck{1}(:, 2), 'LineWidth', 2);
title('Displacement of Unsprung Mass vs. Time (5 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 3a: \rmStuck Tires'});
ylabel('Displacement (in)');
legend('Sprung Mass','Unsprung Mass');

% Subplot (unstuck)
subplot(2, 1, 2);
plot(t{1}, y_unstuck{1}(3, :), t{1}, y_unstuck{1}(2, :), 'LineWidth', 2);
title('Displacement of Unsprung Mass vs. Time (5 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 3b: \rmUnstuck Tires'});
ylabel('Displacement (in)');
legend('Sprung Mass','Unsprung Mass');



%% Displacement of Sprung Mass vs. Time (60 mph)
% The following plots the vertical displacement of the sprung mass as a
% function of time when the horizontal velocity of the car is 60 mph,
% comparing the models plotted on each other.
% 
% The plot indicates an insignificant difference between the stuck and
% unstuck models at 60 mph, probably because the tires do not leave the
% ground for long at such relatively high speeds.

figure;

plot(t{2}, y_stuck{2}(:, 3), t{2}, y_unstuck{2}(3, :), 'LineWidth', 2);
title('Displacement of Sprung Mass vs. Time (60 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 4: \rmDisplacement of Sprung Mass vs. Time (60 mph)'});
ylabel('Displacement (in)');
legend('Stuck','Unstuck');



%% Displacement of Unsprung Mass vs. Time (60 mph)
% The following plots the vertical displacement of the unsprung mass as a
% function of time when the horizontal velocity of the car is 60 mph,
% comparing the models plotted on each other.
% 
% The analysis of this plot falls in line with the analysis of the previous
% plot.

figure;

plot(t{2}, y_stuck{2}(:, 2), t{2}, y_unstuck{2}(2, :), 'LineWidth', 2);
title('Displacement of Unsprung Mass vs. Time (60 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 5: \rmDisplacement of Unsprung Mass vs. Time (60 mph)'});
ylabel('Displacement (in)');
legend('Stuck','Unstuck');



%% Displacement of Sprung and Unsprung Mass vs. Time (60 mph)
% The following plots the vertical displacement of the sprung and unsprung
% mass as a function of time when the horizontal velocity of the car is 5
% mph, comparing the stuck and unstuck models side-by-side.
% 
% % As expected, the plot indicates that the unsprung mass reacts more
% suddenly than the sprung mass; the sprung mass displaces relatively
% little, probably because the horizontal velocity of the car is relatively
% fast at 60 mph.

figure;

% Subplot (stuck)
subplot(2, 1, 1);
plot(t{2}, y_stuck{2}(:, 3), t{2}, y_stuck{2}(:, 2), 'LineWidth', 2);
title('Displacement of Unsprung Mass vs. Time (60 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 6a: \rmStuck Tires'});
ylabel('Displacement (in)');
legend('Sprung Mass','Unsprung Mass');

% Subplot (unstuck)
subplot(2, 1, 2);
plot(t{2}, y_unstuck{2}(3, :), t{2}, y_unstuck{2}(2, :), 'LineWidth', 2);
title('Displacement of Unsprung Mass vs. Time (60 mph)');
xlabel({'Time (s)'
        ''
        % Figure label
        '\bfFigure 6b: \rmUnstuck Tires'});
ylabel('Displacement (in)');
legend('Sprung Mass','Unsprung Mass');



%% Discussion
% While lsim generally produces quicker results, ode45 allows for more
% user control. Each method is better suited for different purposes. Using
% lsim was easier to simulate the quarter-car assuming that the tire never
% leave the ground, for example, as in lab 3a. Using ode45 was easier to
% simulate the quarter-car if it cannot be assumed that the tires never
% leave the ground. Using ode45, it is easy to add logic that allows the
% quarter-car's tire to leave the ground because the programmer has easy
% access to the non-mathematical relationship between xdot and x. However,
% running ode45 with narrow impulses meant to simulate Dirac delta
% functions is tricky because ode45 often "steps" over the narrow input.
% Thus, the maximum step used by ode45 must be manually set for that one
% specific condition, slowing the entire run process. Thus, the choice
% between using lsim and ode45 should depend on the application.


##### SOURCE END #####
--></body></html>
<a name="CarEOM"></a>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>CarEOM</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-02-06"><meta name="DC.source" content="CarEOM.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">CarEOM Usage and Description</a></li><li><a href="#2">Solve for u</a></li><li><a href="#3">Solve for xdot</a></li><li><a href="#4">Unstick Tires</a></li></ul></div><h2 id="1">CarEOM Usage and Description</h2><p>This function represents the equations of motion for the simulation. It returns xdot with inputs of time, x, the A and B state-space matrices, the slope data, the horizontal velocity of the car, the tire's spring constant, the car's unsprung mass, the car's sprung weight, and the car's unsprung weight. See the attached sheet for hand calculations.</p><pre class="codeinput"><span class="keyword">function</span> [xdot] = CarEOM(t, x, A, B, slope, v_x, k_t, m_u, w_c, w_u)
</pre><h2 id="2">Solve for u</h2><p>To find u (in this case, the vertical component of the velocity of the car) corresponding to the time and x value, the following solves for the corresponding distance value, from which it interpolates the corresponding slope value, from which it solves for the corresponding u value, the vertical component of the velocity of the car. Then, knowing the x and u values, the script solves y = A*x + B*u using matrix multiplication.</p><pre class="codeinput">    x_r = v_x*t;                <span class="comment">% Distance of car (ft)</span>
    <span class="comment">% Interpolate slope (m) from distance (in/ft)</span>
    m_r = interp1(slope(:, 1), slope(:, 2), x_r);
    u = v_x*m_r;                <span class="comment">% Vertical velocity (yr_dot) of car (ft/s)</span>
</pre><h2 id="3">Solve for xdot</h2><p>See the attached sheet for hand calculations.</p><pre class="codeinput">    xdot = A*x + B*u;
</pre><h2 id="4">Unstick Tires</h2><p>To unstick the tires, the following checks whether the force in the tire's "spring" exceeds the maximum downward force before the tire separates from the ground. If it does, the acceleration of the unsprung mass must be updated. (The force does not act on the sprung mass). The maximum force is added, the calculated force is subtracted, and this sum is divided by mass to obtain acceleration. This acceleration is the "error" in the calculated acceleration of the unsprung mass. The error is added as a negated value to the acceleration of the unsprung mass because the error points in the opposite direction of the assumed direction of the acceleration of the unsprung mass.</p><pre class="codeinput">    y_r = x(1);                 <span class="comment">% Easy access to y_r</span>
    y_u = x(2);                 <span class="comment">% Easy access to y_u</span>

    f_kt = k_t*(y_u-y_r);       <span class="comment">% Force in spring k_t (stuck)</span>
    fkt_max = w_c + w_u;        <span class="comment">% Saturation threshold</span>

    <span class="keyword">if</span> f_kt &gt; fkt_max
        <span class="comment">% Update the acceleration of the unsprung mass</span>
        xdot(4) = xdot(4) - (fkt_max-f_kt)/m_u;
    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
\n
--></body></html>
